<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <header th:replace="~{fragments/base :: head}"></header>
    <style>
        .stat-card {
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-card p {
            color: #666;
            font-size: 1rem;
        }
        .stat-pending {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .stat-processing {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .stat-shipped {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .stat-delivered {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        .stat-cancelled {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        .section-title {
            margin-top: 30px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #007bff;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<div th:insert="~{fragments/base :: top}"></div>

<div class="container" style="margin-top:80px">
    <div class="row">
        <div class="col-2">
            <aside th:replace="~{fragments/base :: aside('/img/shopping.png')}"></aside>
        </div>

        <div class="col-10">
            <main>
                <h2><strong><i class="fas fa-tachometer-alt"></i> 관리자 대시보드</strong></h2>
                <hr>

                <!-- 주문 통계 섹션 -->
                <h4 class="section-title"><i class="fas fa-chart-bar"></i> 주문 통계</h4>
                <div class="row">
                    <div class="col-md-2">
                        <div class="stat-card stat-pending">
                            <p>주문 대기</p>
                            <h3 th:text="${orderStats['PENDING'] != null ? orderStats['PENDING'] : 0}">0</h3>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card stat-processing">
                            <p>처리 중</p>
                            <h3 th:text="${orderStats['PROCESSING'] != null ? orderStats['PROCESSING'] : 0}">0</h3>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card stat-shipped">
                            <p>배송 중</p>
                            <h3 th:text="${orderStats['SHIPPED'] != null ? orderStats['SHIPPED'] : 0}">0</h3>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card stat-delivered">
                            <p>배송 완료</p>
                            <h3 th:text="${orderStats['DELIVERED'] != null ? orderStats['DELIVERED'] : 0}">0</h3>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card stat-cancelled">
                            <p>취소됨</p>
                            <h3 th:text="${orderStats['CANCELLED'] != null ? orderStats['CANCELLED'] : 0}">0</h3>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stat-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                            <p>전체 주문</p>
                            <h3 th:text="${allOrders.size()}">0</h3>
                        </div>
                    </div>
                </div>

                <!-- 총괄 주문 목록 섹션 -->
                <h4 class="section-title"><i class="fas fa-shopping-cart"></i> 총괄 주문 목록</h4>
                <div class="table-container">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>주문번호</th>
                                <th>주문자</th>
                                <th>주문일시</th>
                                <th>총액</th>
                                <th>배송지</th>
                                <th>상태</th>
                                <th>상세</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${allOrders.isEmpty()}">
                                <td colspan="7" class="text-center">주문 내역이 없습니다.</td>
                            </tr>
                            <tr th:each="order : ${allOrders}">
                                <td th:text="${order.id}">1</td>
                                <td th:text="${order.user.uname}">사용자명</td>
                                <td th:text="${#temporals.format(order.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</td>
                                <td th:text="|${#numbers.formatInteger(order.totalPrice, 0, 'COMMA')}원|">10,000원</td>
                                <td th:text="${order.address}">서울시 강남구</td>
                                <td>
                                    <span class="badge"
                                          th:classappend="${order.status.name() == 'PENDING' ? 'bg-secondary' :
                                                          order.status.name() == 'PROCESSING' ? 'bg-info' :
                                                          order.status.name() == 'SHIPPED' ? 'bg-primary' :
                                                          order.status.name() == 'DELIVERED' ? 'bg-success' : 'bg-danger'}"
                                          th:text="${order.status.name() == 'PENDING' ? '주문대기' :
                                                    order.status.name() == 'PROCESSING' ? '처리중' :
                                                    order.status.name() == 'SHIPPED' ? '배송중' :
                                                    order.status.name() == 'DELIVERED' ? '배송완료' : '취소됨'}">
                                        주문대기
                                    </span>
                                </td>
                                <td>
                                    <a th:href="@{/view/orders/detail/{id}(id=${order.id})}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-eye"></i> 보기
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 사용자 목록 섹션 -->
                <h4 class="section-title"><i class="fas fa-users"></i> 사용자 목록</h4>
                <div class="table-container">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>이름</th>
                                <th>이메일</th>
                                <th>권한</th>
                                <th>가입방법</th>
                                <th>가입일</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${allUsers.isEmpty()}">
                                <td colspan="6" class="text-center">등록된 사용자가 없습니다.</td>
                            </tr>
                            <tr th:each="user : ${allUsers}">
                                <td th:text="${user.id}">1</td>
                                <td th:text="${user.uname}">사용자명</td>
                                <td th:text="${user.email}">user@example.com</td>
                                <td>
                                    <span class="badge"
                                          th:classappend="${user.role.name() == 'ADMIN' ? 'bg-danger' : 'bg-success'}"
                                          th:text="${user.role.name() == 'ADMIN' ? '관리자' : '일반사용자'}">
                                        일반사용자
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-info" th:text="${user.loginProvider != null ? user.loginProvider.name() : 'LOCAL'}">LOCAL</span>
                                </td>
                                <td th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'yyyy-MM-dd') : '-'}">2024-01-01</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 text-center">
                    <button type="button" class="btn btn-secondary" onclick="location.href='/view/bookEs/list'">
                        <i class="fas fa-home"></i> 홈으로
                    </button>
                </div>
            </main>
        </div>
    </div>
</div>

<div th:insert="~{fragments/base :: bottom}"></div>
</body>
</html>
