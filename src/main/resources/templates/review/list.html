<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <header th:replace="~{fragments/base :: head}"></header>
  <style>
    .rating {
      color: #ffc107;
    }
    .review-card {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 5px;
    }
    .star-rating {
      display: inline-block;
      font-size: 20px;
    }
  </style>
</head>
<body>
<div th:insert="~{fragments/base :: top}"></div>

<div class="container" style="margin-top:80px">
  <div class="row">
    <div class="col-3">
      <aside th:replace="~{fragments/base :: aside('/img/review.png')}"></aside>
    </div>

    <div class="col-9">
      <main>
        <h3><strong>도서 리뷰</strong></h3>
        <hr>

        <!-- 평균 평점 -->
        <div class="card mb-3">
          <div class="card-body">
            <h5>평균 평점</h5>
            <div class="d-flex align-items-center">
              <span class="rating" style="font-size: 2rem; margin-right: 10px;">
                <span th:text="${averageRating != null ? #numbers.formatDecimal(averageRating, 1, 1) : '0.0'}">4.5</span>
              </span>
              <span class="star-rating">
                <span th:each="i : ${#numbers.sequence(1, 5)}">
                  <i th:class="${i <= (averageRating ?: 0) ? 'fas fa-star rating' : 'far fa-star'}"></i>
                </span>
              </span>
              <span class="ms-2">([[${reviewCount}]]개의 리뷰)</span>
            </div>
          </div>
        </div>

        <!-- 리뷰 작성 버튼 -->
        <div class="mb-3">
          <a th:href="@{/api/reviews/book/{bookId}(bookId=${bookId})}" class="btn btn-primary">리뷰 작성</a>
        </div>

        <!-- 리뷰 목록 -->
        <div th:if="${reviews.isEmpty()}" class="alert alert-info">
          아직 작성된 리뷰가 없습니다. 첫 번째 리뷰를 작성해보세요!
        </div>

        <div th:each="review : ${reviews}" class="review-card">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <strong th:text="${review.userName}">사용자명</strong>
              <span class="star-rating ms-2">
                <span th:each="i : ${#numbers.sequence(1, 5)}">
                  <i th:class="${i <= review.rating ? 'fas fa-star rating' : 'far fa-star'}"></i>
                </span>
              </span>
            </div>
            <small class="text-muted" th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</small>
          </div>
          <p th:text="${review.content}">리뷰 내용입니다.</p>
          <div th:if="${review.updatedAt != null && review.updatedAt != review.createdAt}">
            <small class="text-muted">(수정됨: [[${#temporals.format(review.updatedAt, 'yyyy-MM-dd HH:mm')}]])</small>
          </div>
        </div>

        <!-- 페이징 -->
        <nav th:if="${totalPages > 1}">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
              <a class="page-link" th:href="@{/view/reviews/book/{bookId}(bookId=${bookId}, page=${currentPage - 1})}">이전</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}" th:classappend="${i == currentPage ? 'active' : ''}">
              <a class="page-link" th:href="@{/view/reviews/book/{bookId}(bookId=${bookId}, page=${i})}" th:text="${i}">1</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages ? 'disabled' : ''}">
              <a class="page-link" th:href="@{/view/reviews/book/{bookId}(bookId=${bookId}, page=${currentPage + 1})}">다음</a>
            </li>
          </ul>
        </nav>

      </main>
    </div>
  </div>
</div>
</body>
</html>
